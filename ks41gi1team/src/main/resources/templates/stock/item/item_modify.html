<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="@{layout/default}">

<th:block layout:fragment="customTitle">
	<title>[[${SectionLocation}]]</title>
</th:block>
<th:block layout:fragment="customCss"></th:block>
<th:block layout:fragment="customJs">
<script type="text/javascript">
$(()=>{
	var modifyItem = $('#modifyItem'); //수정폼
	var itemType = $('#itemType'); //품목분류
	var submitBtn = $('#submitBtn'); //수정버튼
	var largeCategory = $('#largeCategory');
	var middleCategory = $('#middleCategory');
	var smallCategory = $('#smallCategory');
	var microCategory = $('#microCategory');
	
	//중분류 자동출력
	largeCategory.on('change', function(){
		var request = $.ajax({
			  url: "/getLowCategory", //호출 경로
			  type: "POST", //호출 방식
			  data: { 'largeCategory' : largeCategory.val(), 'middleCategory' : null, 'smallCategory' : null },
		});
		
		//정상적인 응답이 되었을 경우 실행되는 메서드
		request.done(function( data ) {
			var dataArr = data['middleCategory'];
 			var categoryOption = middleCategory.children(":first");
			categoryOption.siblings().remove(); //중분류 청소
			smallCategory.children(':first').siblings().remove(); //소분류 청소
			microCategory.children(':first').siblings().remove(); //소소분류 청소
			for(var i=0; i<dataArr.length; i++) {
				middleCategory.append(categoryOption.clone().val(dataArr[i]).text(dataArr[i]));
			}
		});
		
		//응답 중 에러가 발생하거나, 데이터 parsing 에러 시 실행되는 메서드
		request.fail(function( jqXHR, textStatus ) {
			alert( "Request failed: " + textStatus );
		});
	});
	//소분류 자동출력
	middleCategory.on('change', function(){
		var request = $.ajax({
			  url: "/getLowCategory", //호출 경로
			  type: "POST", //호출 방식
			  data: { 'largeCategory' : largeCategory.val(), 'middleCategory' : middleCategory.val(), 'smallCategory' : null },
		});
		
		//정상적인 응답이 되었을 경우 실행되는 메서드
		request.done(function( data ) {
			var dataArr = data['smallCategory'];
 			var categoryOption = smallCategory.children(":first");
			categoryOption.siblings().remove(); //소분류 청소
			microCategory.children(':first').siblings().remove(); //소소분류 청소
			for(var i=0; i<dataArr.length; i++) {
				smallCategory.append(categoryOption.clone().val(dataArr[i]).text(dataArr[i]));
			}
		});
		
		//응답 중 에러가 발생하거나, 데이터 parsing 에러 시 실행되는 메서드
		request.fail(function( jqXHR, textStatus ) {
			alert( "Request failed: " + textStatus );
		});
	});
	//소소분류 자동출력
	smallCategory.on('change', function(){
		var request = $.ajax({
			  url: "/getLowCategory", //호출 경로
			  type: "POST", //호출 방식
			  data: { 'largeCategory' : largeCategory.val(), 'middleCategory' : middleCategory.val(), 'smallCategory' : smallCategory.val() },
		});
		
		//정상적인 응답이 되었을 경우 실행되는 메서드
		request.done(function( data ) {
			var dataArr = data['microCategory'];
			//console.log(data['microCategory']);
 			var categoryOption = microCategory.children(":first");
			categoryOption.siblings().remove(); //소소분류 청소
			for(var i=0; i<dataArr.length; i++) {
				microCategory.append(categoryOption.clone().val(dataArr[i]).text(dataArr[i]));
			}
		});
		
		//응답 중 에러가 발생하거나, 데이터 parsing 에러 시 실행되는 메서드
		request.fail(function( jqXHR, textStatus ) {
			alert( "Request failed: " + textStatus );
		});
	});
	
	$(document).on('click', '#submitBtn', function(){
		if(itemType.val() == '제품') {
			if(largeCategory.val() == "" || middleCategory.val() == "" || smallCategory.val() == "") {
				alert('품목 카테고리를 선택해주세요.');
			} else {
				modifyItem.submit();
			}
		}else{
			modifyItem.submit();
		}
	});
});
</script>
</th:block>
<th:block layout:fragment="customStyle"></th:block>

<th:block layout:fragment="SectionTitle">[[${SectionTitle}]]</th:block>
<th:block layout:fragment="SectionLocation">[[${SectionLocation}]]</th:block>

<th:block layout:fragment="customContents">

<div class="container-fluid">
	<div class="row">
		<div class="col-lg-3 col-md-2">
		</div>
		<div class="col-lg-6 col-md-8">
			<div class="card card-info card-outline">
				<div class="card-header">
					품목정보 수정
				</div>
				<div class="card-body" th:if="${i} != null">
					<form id="modifyItem"th:action="@{/k1ItemModify}" method="POST">
						<div class="form-group">
							<label for="itemName">
								품목명
							 </label>
							<input type="text" id="itemName" name="itemName" class="form-control" placeholder="Enter itemName" th:value="${i.itemName}">
						</div>
						<div class="row">
							<div class="form-group col-3">
								<label>분류</label>
								<select id="itemType" name="itemType" class="form-control">
									<option th:selected="'원자재' == ${i.itemType}">원자재</option>
									<option th:selected="'부자재' == ${i.itemType}">부자재</option>
									<option th:selected="'제품' == ${i.itemType}">제품</option>
								</select>
							</div>
							<div class="form-group col-3">
								<label for="itemStandard">규격</label>
								<input type="text" name="itemStandard" class="form-control" id="itemStandard" placeholder="Enter itemStandard" th:value="${i.itemStandard}">
							</div>
							<div class="form-group col-3">
								<label for="itemOrigin">원산지</label>
								<input type="text" name="itemOrigin" class="form-control" id="itemOrigin" placeholder="Enter itemOrigin" th:value="${i.itemOrigin}">
							</div>
							<div class="form-group col-3">
								<label for="itemStatus">상태</label>
								<input type="text" name="itemStatus" class="form-control" id="itemStatus" placeholder="Enter itemStatus" th:value="${i.itemStatus}">
							</div>
						</div>
						<div id="itemCategory" class="form-group">
							<label>카테고리</label>
							<div class="form-group row">
								<div class="col-3">
									<select id="largeCategory" name="largeCategory" class="form-control">
										<option value="">:: 대분류 ::</option>
										<option th:each="l : ${largeCategory}" th:selected="${l} == ${i.largeCategory}">[[${l}]]</option>
									</select>
								</div>
								<div class="col-3">
									<select id="middleCategory" name="middleCategory" class="form-control">
										<option value="">:: 중분류 ::</option>
										<option th:each="m : ${middleCategory}" th:selected="${m} == ${i.middleCategory}">[[${m}]]</option>
									</select>
								</div>
								<div class="col-3">
									<select id="smallCategory" name="smallCategory" class="form-control">
										<option value="">:: 소분류 ::</option>
										<option th:each="s : ${smallCategory}" th:selected="${s} == ${i.smallCategory}">[[${s}]]</option>
									</select>
								</div>
								<div class="col-3">
									<select id="microCategory" name="microCategory" class="form-control">
										<option value="">:: 소소분류 ::</option>
										<option th:each="xs : ${microCategory}" th:selected="${xs} == ${i.microCategory}">[[${xs}]]</option>
									</select>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label for="itemComment">비고</label>
							<input type="text" name="itemComment" class="form-control" id="itemComment" placeholder="Enter comment" th:value="${i.itemComment}">
						</div>
					</form>
				</div>
				<div class="card-body" th:if="${i} == null">
					잘못된 접근입니다.
				</div>
				<div class="card-footer">
					<th:block th:if="${i} != null">
						<button type="button" id="submitBtn" class="btn btn-info float-right">수정하기</button>
						<a th:href="@{|/k1Item/${i.itemCode}|}">
							<button type="button" class="btn btn-default">이전으로</button>
						</a>
					</th:block>
					<th:block th:if="${i} == null">
						<a th:href="@{/k1Item}">
							<button type="button" class="btn btn-default">이전으로</button>
						</a>
					</th:block>
				</div>
			</div>
		</div>
	</div>
</div>



</th:block>

</html>