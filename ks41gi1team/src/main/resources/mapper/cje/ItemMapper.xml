<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="k1.smart.team.mapper.cje.ItemMapper">

<select id="getAllItemList" parameterType="String" resultType="Stock">
	SELECT
		 RIGHT(i.itemCode,3) AS itemCode
		,i.itemName
		,i.itemType
		,RIGHT(i.categoryCode,3) AS categoryCode
		,c.largeCategory
		,c.middleCategory
		,c.smallCategory
		,c.microCategory
		,i.itemStandard
		,i.itemOrigin
		,i.itemStatus
		,i.itemComment
		,i.regDate AS itemRegDate
		,i.updateDate AS itemUpdateDate
	FROM
		k1_tb_item_info AS i
		LEFT JOIN
		k1_tb_item_category AS c
		ON
		i.categoryCode = c.categoryCode
	WHERE
		i.mainBusinessCode = #{mainBusinessCode};
</select>

<select id="getItemInfo" parameterType="String" resultType="Stock">
	SELECT
		 RIGHT(i.itemCode,3) AS itemCode
		,i.itemName
		,i.itemType
		,i.categoryCode
		,c.largeCategory
		,c.middleCategory
		,c.smallCategory
		,c.microCategory
		,s.itemCount
		,i.itemOrigin
		,AVG(p.productPrice) AS avgPrice
		,SUM(s.totalPrice) AS totalPrice
		,SUM(s.stockWeight) AS stockWeight
		,i.itemStandard
		,i.itemStatus
		,i.itemComment
		,i.regDate AS itemRegDate
		,i.updateDate AS itemUpdateDate
	FROM
		k1_tb_item_info AS i
		LEFT JOIN
		k1_tb_item_category AS c
		ON
		i.categoryCode = c.categoryCode
		LEFT JOIN
		k1_tb_stock AS s
		ON
		i.itemCode = s.itemCode
		LEFT JOIN
		k1_tb_product_price AS p
		ON
		s.productPriceCode = p.productPriceCode
	WHERE
		i.itemCode = CONCAT('itemCode_',#{itemCode});
</select>

<select id="getItemStock" parameterType="String" resultType="Stock">
	SELECT
		 RIGHT(s.inventoryCode,3) AS inventoryCode
		,RIGHT(w.warehouseCode,3) AS warehouseCode
		,w.warehouseName
		,w.loaction
		,w.outPlace
		,s.stockWeight
		,s.itemCount
		,p.productPrice
		,s.totalPrice
		,s.purchaseTsCode
		,s.productPriceCode
	FROM
		k1_tb_stock AS s
		JOIN
		k1_tb_item_info AS i
		ON
		s.itemCode = i.itemCode
		JOIN
		k1_tb_warehouse_info AS w
		ON
		s.warehouseCode = w.warehouseCode
		LEFT JOIN
		k1_tb_product_price AS p
		ON
		s.productPriceCode = p.productPriceCode
	WHERE
		i.itemCode = CONCAT('itemCode_',#{itemCode});
</select>

</mapper>