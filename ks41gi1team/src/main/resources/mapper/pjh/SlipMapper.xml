<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="k1.smart.team.mapper.pjh.SlipMapper">
	<select id="getAll_P_SlipList" parameterType="String" resultType="Slip">
		SELECT
			p.purchaseSlipCode
			,p.amount
			,p.tax
			,p.count
			,((p.amount + p.tax) * p.COUNT) AS amt
			,c.businessName
			,p.briefs
		FROM
			k1_tb_purchase_slip AS p
		JOIN
			k1_tb_client AS c
		ON 
			p.clientCode = c.clientCode
		WHERE
			p.mainBusinessCode = #{mainBusinessCode};

	</select>
	<select id="getAll_S_SlipList" parameterType="String" resultType="Slip">
		SELECT
			s.salesSlipCode
			,s.amount
			,s.tax
			,s.count
			,((s.amount + s.tax) * s.COUNT) AS amt
			,c.businessName
			,s.briefs
		FROM
			k1_tb_sales_slip AS s
		JOIN
			k1_tb_client AS c
		ON 
			s.clientCode = c.clientCode
		WHERE
			s.mainBusinessCode = #{mainBusinessCode};
	</select>
	<select id="getPurchaseSlipInfo" parameterType="String" resultType="Slip">
		SELECT
			p.purchaseSlipCode
			,p.amount
			,p.tax
			,p.count
			,p.purchaseTsCode
			,((p.amount + p.tax) * p.COUNT) AS amt
			,c.businessName
			,p.briefs
			,p.regDate
			,p.updateDate
			,u.userName
		FROM
			k1_tb_purchase_slip AS p
		JOIN
			k1_tb_client AS c
		ON 
			p.clientCode = c.clientCode
		INNER JOIN 
			k1_tb_user AS u
			ON 
			p.regId = u.userId
		WHERE
			purchaseSlipCode = #{purchaseSlipCode};
	</select>
	<select id="getSalesSlipInfo" parameterType="String" resultType="Slip">
		SELECT
			s.salesSlipCode
			,s.amount
			,s.tax
			,s.salesTsCode
			,s.count
			,((s.amount + s.tax) * s.COUNT) AS amt
			,c.businessName
			,s.briefs
			,s.regDate
			,s.updateDate
			,u.userName
		FROM
			k1_tb_sales_slip AS s
		JOIN
			k1_tb_client AS c
		ON 
			s.clientCode = c.clientCode
		INNER JOIN 
			k1_tb_user AS u
			ON 
			s.regId = u.userId
		WHERE
			salesSlipCode = #{salesSlipCode};
	</select>
	<select id="getPurchaseTransactionCode" parameterType="String" resultType="Slip">
		SELECT
			RIGHT(pt.purchaseTsCode,3) as purchaseTsCode
			,pt.briefs
		FROM
			k1_tb_purchase_transaction AS pt
		WHERE
			pt.mainBusinessCode = #{mainBusinessCode};
	</select>
	<select id="getSalesTransactionCode" parameterType="String" resultType="Slip">
		SELECT
			RIGHT(st.salesTsCode,3) as salesTsCode
			,st.briefs
		FROM
			k1_tb_sales_transaction AS st
		WHERE
			st.mainBusinessCode = #{mainBusinessCode};
	</select>
	<select id="addSlip" parameterType="String" resultType="Slip">
		INSERT INTO k1_tb_purchase_slip(
			purchaseSlipCode
			,mainBusinessCode
			,totalAccountCode
			,purchaseTsCode
			,clientCode
			,amount
			,tax
			,count
			,briefs
			,regId
			,regDate
			,updateDate
		)VALUES(
			#{purchaseSlipCode}
			,'fac_ksmartSeoul_Seoul_001'
			,#{totalAccountCode}
			,#{purchaseTsCode}
			,#{clientCode}
			,#{amount}
			,#{tax}
			,#{count}
			,#{briefs}
			,#{regId}
			,CURDATE()
			,CURDATE()
		);
	</select>
	<select id="saleTransactionList" parameterType="map" resultType="map">
	SELECT
		salesTsCode
		,clientCode
		,amount
		,VAT
		,count
		,briefs
	FROM
		k1_tb_sales_transaction
	</select>
</mapper>